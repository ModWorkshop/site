<template>
	<tr class="mod items-center mt-2 content-block" :title="mod.short_desc">
		<td v-if="displayMode == 1" width="200px;">
			<NuxtLink class="block" :to="!static && `/mod/${mod.id}` || undefined">
				<mod-thumbnail :thumbnail="mod.thumbnail" :lazy="lazyThumbnail"/>
			</NuxtLink>
		</td>

		<td>
			<NuxtLink class="mod-title" style="min-width: 150px;" :to="!static && `/mod/${mod.id}` || undefined" :title="mod.name">
				<mod-status :mod="mod"/>
				{{ mod.name }}
			</NuxtLink>
		</td>

		<td>
			<a-user :static="static" class="text-secondary" :user="mod.user"/>
		</td>

		<td v-if="!lite && !noCategories">
			<template v-if="(mod.game && showGame) || mod.category">
				<NuxtLink v-if="showGame" class="text-secondary" :to="!static && gameUrl || undefined" :title="mod.game">{{ mod.game!.name }}</NuxtLink>
				<template v-if="mod.category">
					<span v-if="showGame" class="text-secondary"> / </span>
					<NuxtLink class="text-secondary" :to="!static && `${gameUrl}/mods?category=${mod.category_id}` || undefined" :title="mod.category.name">{{ mod.category.name }}</NuxtLink>
				</template>
			</template>
			<span v-else>
				{{ $t('not_available') }}
			</span>
		</td>
		<td v-if="!lite" class="text-center">{{ likes }}</td>
		<td v-if="!lite" class="text-center">{{ downloads }}</td>
		<td v-if="!lite" class="text-center">{{ views }}</td>
		<td v-if="!lite" class="text-center">
			<m-time :datetime="date" relative/>
		</td>
		<slot name="definitions"/>
	</tr>
</template>

<script setup lang="ts">
import { useStore } from '~/store';
import type { Mod } from '~/types/models';
const store = useStore();

const props = withDefaults(defineProps<{
	displayMode?: number;
	lazyThumbnail?: boolean;
	sort?: string;
	noCategories?: boolean;
	noGame?: boolean;
	mod: Mod;
	static?: boolean;
	lite?: boolean;
}>(), { displayMode: 1, lite: false });

const showGame = computed(() => !props.noGame && props.mod.game);
const date = computed(() => props.sort === 'published_at' ? props.mod.published_at : props.mod.bumped_at);
const likes = computed(() => props.mod.likes);
const downloads = computed(() => props.mod.downloads);
const views = computed(() => props.mod.views);
const gameUrl = computed(() => `/g/${store.currentGame?.short_name || props.mod.game?.short_name || props.mod.game?.id}`);
</script>

<style scoped>
.mod-title {
	overflow: hidden;
	word-break: break-word;
	white-space: pre-wrap;
}
</style>
